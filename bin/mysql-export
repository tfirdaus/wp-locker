#!/bin/bash
source "$(dirname "$0")/shared"

# Show a fancy banner \o/
banner

export TIMESTAMP=$(date +"%Y-%m-%d-%H%M%S")

# Get the WordPress variables.
while IFS= read -r line; do
	export $(echo -e "$line" | sed -e 's/[[:space:]]*$//' -e "s/'//g")
done < <(cat .env | grep DATABASE_)

echo "📤 Exporting the '${DATABASE_NAME}' database."
echo "📦 Generating dump/${DATABASE_NAME}-${TIMESTAMP}.sql."

# Make sure the '/data' directory exist to store the database dump
mkdir -p data
docker-compose exec database mysqldump --opt \
    -h ${DATABASE_HOST%:*} \
    -P${DATABASE_HOST#*:} \
    -u ${DATABASE_USER} \
    -p${DATABASE_PASSWORD} \
    ${DATABASE_NAME} \
    > dump/${DATABASE_NAME}-${TIMESTAMP}.sql
echo "👌🏼 Done!"
